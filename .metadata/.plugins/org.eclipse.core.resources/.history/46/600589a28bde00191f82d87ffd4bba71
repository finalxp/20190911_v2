package com.example.service.impl;



import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.example.mapper.QueryDepAdminMapper;
import com.example.model.Department;
import com.example.model.EmpDepList;
import com.example.model.User;
import com.example.service.IQueryDepAdminService;

@Service
public class QueryDepAdminService implements IQueryDepAdminService{

	@Autowired
	QueryDepAdminMapper queryDepAdminMapper;
	
	@SuppressWarnings("null")
	@Override
	public List<EmpDepList> queryDepAdmin() {
		
		//返回EmpDepList实体的集合list
		List<EmpDepList> empDepList = null;
		
		//返回的EmpDepList实体
		EmpDepList empDep = null;
		
		//查询到的所有为"2"的管理员集合list
		List<User> admin2list;
		
		//do...while中循环用的当前部门id
		String depNoSub;
		
		//do...while中循环用的上级部门id
		String depNoSup;
		
		//1.查询所有为"2"的管理员的根部门，查询该用户的上级部门id
		admin2list = queryDepAdminMapper.queryDepAdminList();
		
		//测试：打印list集合是否正确
		for (User string : admin2list) {
			System.out.println(string.getUser_dep_id());
		}
		
		//2.循环当上级部门id不为"0"或"1"时，returnNull；当上级部门id为"0"或"1"时，添加empdeplist实体类到list
		
		//2.1 do...while
		System.out.println("-------循环开始-------");
		for (User string : admin2list) {
			String getUser_dep_id = string.getUser_dep_id();
			System.out.println();
			String name = string.getName();
			depNoSub = getUser_dep_id;
			
			Department supDepMapper = queryDepAdminMapper.getSupDepMapper(depNoSub);
			depNoSup = supDepMapper.getDepartment_sup_id();
			while (depNoSup.equals("0") || depNoSup.equals("1")) {
				depNoSub = depNoSup;//永远为下级部门，用于返回实体类
				//depNoSup = queryDepAdminMapper.getSupDepMapper(depNoSup);		
				Department supDepMapper2 = queryDepAdminMapper.getSupDepMapper(depNoSup);
				depNoSup = supDepMapper2.getDepartment_sup_id();
			}
			Department departmentNameMapper = queryDepAdminMapper.getDepartmentNameMapper(depNoSub);
			String department_name = departmentNameMapper.getDepartment_name();
			empDep.setEmployee(name);
			empDep.setEmployee(department_name);
			empDepList.add(empDep);
		}

		return empDepList;
	}

}
